<?xml version="1.0" encoding="utf-8"?>

<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             xmlns:viewmodel="clr-namespace:BankingApp.UI.ViewModels"
             xmlns:entities="clr-namespace:BankingApp.Entities.Users"
             x:Class="BankingApp.UI.Views.UsersPage"
             x:DataType="viewmodel:AdminPanelViewModel">
   
    <RefreshView IsRefreshing="{Binding IsRefreshing}"
                 Command="{Binding RefreshCommand}">
        <VerticalStackLayout>
            <Label Text="Пользователи системы"
                   HorizontalOptions="Center"
                   FontSize="22"
                   Margin="0,10,0,10" />
            <CollectionView ItemsSource="{Binding Users}"
                            SelectedItem="{Binding SelectedUser}"
                            SelectionMode="Single">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="entities:User">
                        <toolkit:Expander>
                            <toolkit:Expander.Header>
                                <HorizontalStackLayout Padding="5" Spacing="10">
                                    <Label Text="Логин: " FontAttributes="Bold" />
                                    <Label Text="{Binding Username}" />
                                </HorizontalStackLayout>
                            </toolkit:Expander.Header>
                            <toolkit:Expander.Content>
                                <VerticalStackLayout Margin="5,0,0,0" Spacing="5">
   
                                    <HorizontalStackLayout Spacing="10">
                                        <Label Text="ID: " FontAttributes="Bold" />
                                        <Label Text="{Binding UserId}" />
                                    </HorizontalStackLayout>
   
                                    <HorizontalStackLayout Spacing="10">
                                        <Label Text="Тип пользователя: " FontAttributes="Bold" />
                                        <Label Text="{Binding CustomerType}"></Label>
                                    </HorizontalStackLayout>
   
                                    <HorizontalStackLayout Spacing="10">
                                        <Label Text="Роль: " FontAttributes="Bold" />
                                        <Label Text="{Binding Role}" />
                                    </HorizontalStackLayout>
   
                                    <HorizontalStackLayout Spacing="10">
                                        <Label Text="Пароль: " FontAttributes="Bold" />
                                        <Label Text="{Binding Password}" />
                                    </HorizontalStackLayout>
   
                                    <HorizontalStackLayout Spacing="10">
                                        <Label Text="Назначить роль"
                                               VerticalOptions="Center"
                                               FontAttributes="Bold" />
   
                                        <Picker
                                            ItemsSource="{Binding
                                                    Source={RelativeSource AncestorType=
                                                            {x:Type viewmodel:AdminPanelViewModel}},
                                                            Path=AvailableRoles}"
                                            SelectedItem="{Binding
                                                    Source={RelativeSource AncestorType=
                                                            {x:Type viewmodel:AdminPanelViewModel}},
                                                            Path=SelectedUserRole, Mode=TwoWay}"
                                            HorizontalOptions="Fill"
                                            Height="20"
                                            />
                                        <Button Text="Применить"
                                                HorizontalOptions="Fill"
                                                Height="20"
                                                Command="{Binding
                                                    Source={RelativeSource AncestorType=
                                                            {x:Type viewmodel:AdminPanelViewModel}},
                                                            Path=AssignRoleCommand}"
                                                CommandParameter="{Binding .}"/>
                                    </HorizontalStackLayout>
                                </VerticalStackLayout>
                            </toolkit:Expander.Content>
                        </toolkit:Expander>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </VerticalStackLayout>
    </RefreshView>
</ContentPage>